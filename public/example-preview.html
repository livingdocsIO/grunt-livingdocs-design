<html>
<head>
  <title>Emmet Documentation</title>


    <link href="http://fonts.googleapis.com/css?family=Handlee" rel="stylesheet">
    <link rel="stylesheet" href="/css/livingdocs.css">

    <!-- load design css (and fonts) -->
    <script src="/js/vendor/jquery-1.9.js"></script>


    <!-- dependencies of livingdocs-engine -->
    <script src="/js/vendor/yepnope/yepnope.1.5.3-min.js"></script>
    <script src="/js/vendor/store/store.js"></script>
    <script src="/js/vendor/editableJS/editable.js"></script>
    <script src="/designs/bootstrap/design.js"></script>
    <script src="/js/livingdocs_engine.js"></script>
</head>
<body>

  <!-- document template with content to easily preview and test a design -->
  <hero>
    <title>Snippet outside container</title>
    <tagline>Yep, it works</tagline>
  </hero>

  <column>
    <default>
      <main-and-sidebar>
        <main>
          <hero>
            <title>Houston, we have a problem.</title>
            <tagline>Test</tagline>
          </hero>
        </main>
        <sidebar>
          <text>Sharks in a tornado. Sharknado. Simply stunning.</text>
          <text>Have you ever sucked feet for weed?</text> 
        </sidebar>
      </main-and-sidebar>

      <text>Sharks in a tornado. Sharknado. Simply stunning.</text>
      <text>Have you ever sucked feet for weed?</text>
      <text>That pet store's got everything we need. Except for piranhas.</text>
      <text>My life is as good as an Abba song. Itâ€™s as good as Dancing Queen.</text>
      <text>See what happens when you find a stranger in the alps?</text>
    </default>
  </column>



  
  <!-- script to parse and render the template -->
  <script>
 
    function snippetName(element) {
      var tagName = element.tagName;
      if(tagName) {
        return $.camelCase(tagName.toLowerCase())
      }
      return null;
    }

    function getEditables(snippet) {
      if (!snippet.editables) return null; 
      return Object.keys(snippet.editables);
    }


    function getContainers(snippet) {
      if (!snippet.containers) return null; 
      return Object.keys(snippet.containers);
    }


    function getChildNodes(data, tags) {
      var nodes = [];
      if(!data.childNodes) return null;

      for (var i = data.childNodes.length - 1; i >= 0; i--) {
        if (tags) {
          if(tags.indexOf(snippetName(data.childNodes[i])) != -1) nodes.push(data.childNodes[i]);
        }
        else {
          if (data.childNodes[i].nodeType == 1 && data.childNodes[i].tagName != 'SCRIPT') {
            nodes.push(data.childNodes[i]); 
          }
        }
      };  
      return nodes;
    }
    

    doc.kickstart = function(html) {

      var content = $(html).children().not('script');
      $(html).html('<div class="doc-section"></div>');
      doc.loadDocument();
      

      doc.ready(function() {

        content.each(function() {
          var row = doc.add(snippetName(this));
          parseContainers(row, this);
          setEditables(row, this);
        })

            
        function parseContainers(parent, data) {
          if(parent.hasContainers()) {
            var containers = getChildNodes(data, getContainers(parent));
            for (var i = containers.length - 1; i >= 0; i--) {
              
              var children = getChildNodes(containers[i]);
              for (var c = children.length - 1; c >= 0; c--) {
                parseSnippets(parent, snippetName(containers[i]), children[c])
              };

            };
          }
        }

        function parseSnippets(parent, region, data) {
            var snippet = doc.create(snippetName(data));
            parent.append(region, snippet);
            setEditables(snippet, data);
            parseContainers(snippet, data);
        }

        function setEditables(parent, data) {
          if(parent.hasEditables()) {
            for(var key in parent.editables) {
              parent.set(key, null);
              var child = getChildNodes(data, [key])[0];
              if(!child) parent.set(key, data.innerHTML);
              else parent.set(key, child.innerHTML);
            }
          }
        }

      });

    }



    doc.addDesign(design.bootstrap.snippets, design.bootstrap.config);
    
    // use a jQuery selector as destination
    doc.kickstart('body');


  </script>

</body>
</html>
