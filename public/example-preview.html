<html>
<head>
  <title>Emmet Documentation</title>


    <link href="http://fonts.googleapis.com/css?family=Handlee" rel="stylesheet">
    <link rel="stylesheet" href="/css/livingdocs.css">

    <!-- load design css (and fonts) -->
    <script src="/js/vendor/jquery-1.9.js"></script>


    <!-- dependencies of livingdocs-engine -->
    <script src="/js/vendor/yepnope/yepnope.1.5.3-min.js"></script>
    <script src="/js/vendor/store/store.js"></script>
    <script src="/js/vendor/editableJS/editable.js"></script>
    <script src="/designs/bootstrap/design.js"></script>
    <script src="/js/livingdocs_engine.js"></script>
</head>
<body>

  <!-- document template with content to easily preview and test a design -->
  <hero>
    <title>Snippet outside container</title>
    <tagline>Yep, it works</tagline>
  </hero>

  <column>
      <main-and-sidebar>
        <main>
          <hero>
            <title>Houston, we have a problem.</title>
            <tagline>Test</tagline>
          </hero>
        </main>
        <sidebar>
          <text>Sharks in a tornado. Sharknado. Simply stunning.</text>
          <text>Have you ever sucked feet for weed?</text> 
        </sidebar>
      </main-and-sidebar>

      <text>Sharks in a tornado. Sharknado. Simply stunning.</text>
      <text>Have you ever sucked feet for weed?</text>
      <text>That pet store's got everything we need. Except for piranhas.</text>
      <text>My life is as good as an Abba song. Itâ€™s as good as Dancing Queen.</text>
      <text>See what happens when you find a stranger in the alps?</text>
  </column>



  
  <!-- script to parse and render the template -->
  <script>


    doc.kickstart = function(html) {

      var content = $(html).children().not('script');
      $(html).html('<div class="doc-section"></div>');
      doc.loadDocument();

      doc.ready(function() {

        // Add all snippets in the dom to the document.
        // Process all containers and editables if available in the snippet.
        content.each(function() {
          var row = doc.add(toSnippetName(this));
          parseContainers(row, this);
          setEditables(row, this);
        })

        
        // Convert a dom element into a camelCase snippetName      
        function toSnippetName(element) {
          return (element.tagName)? $.camelCase(element.tagName.toLowerCase()) : null;
        }


        // process all containers
        function parseContainers(parent, data) {
          var containers = (parent.containers)? Object.keys(parent.containers): [];
          if (containers.length == 1 && containers.indexOf('default') != -1 && !$('default', data).length) {
            var children = $(data).children();
            for (var c = children.length - 1; c >= 0; c--) {
              parseSnippets(parent, 'default', children[c])
            };
            return;
          }

          var elements = $(containers.join(','), data);
          for (var i = elements.length - 1; i >= 0; i--) {
            
            var children = $(elements[i]).children();
            for (var c = children.length - 1; c >= 0; c--) {
              parseSnippets(parent, toSnippetName(elements[i]), children[c])
            };

          };
        }


        // Add snippet and parse its containers and editables
        function parseSnippets(parent, region, data) {
          var snippet = doc.create(toSnippetName(data));
          parent.prepend(region, snippet);
          parseContainers(snippet, data);
          setEditables(snippet, data);
        }


        // Set all editables of a livingdocs element
        function setEditables(parent, data) {
          if(parent.hasEditables()) {
            for(var key in parent.editables) {
              parent.set(key, null);
              var child = $(key + ':first', data).get()[0];
              if(!child) parent.set(key, data.innerHTML);
              else parent.set(key, child.innerHTML);
            }
          }
        }

      });

    }



    doc.addDesign(design.bootstrap.snippets, design.bootstrap.config);
    
    // use a jQuery selector as destination
    doc.kickstart('body');


  </script>

</body>
</html>
