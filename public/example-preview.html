<html>
<head>
  <title>Emmet Documentation</title>


    <link href="http://fonts.googleapis.com/css?family=Handlee" rel="stylesheet">
    <link rel="stylesheet" href="/css/livingdocs.css">

    <!-- load design css (and fonts) -->
    <script src="/js/vendor/jquery-1.9.js"></script>


    <!-- dependencies of livingdocs-engine -->
    <script src="/js/vendor/yepnope/yepnope.1.5.3-min.js"></script>
    <script src="/js/vendor/store/store.js"></script>
    <script src="/js/vendor/editableJS/editable.js"></script>
    <script src="/designs/bootstrap/design.js"></script>
    <script src="/js/livingdocs_engine.js"></script>
</head>
<body>

  <!-- document template with content to easily preview and test a design -->
    <hero>
      <title>Snippet outside container</title>
      <tagline>Yep, it works</tagline>
    </hero>

    <column>
      <default>
        <main-and-sidebar>
          <main>
            <hero>
              <title>Houston, we have a problem.</title>
              <tagline>Test</tagline>
            </hero>
          </main>
          <sidebar>
            <text>Sharks in a tornado. Sharknado. Simply stunning.</text>
            <text>Have you ever sucked feet for weed?</text> 
          </sidebar>
        </main-and-sidebar>

        <text>Sharks in a tornado. Sharknado. Simply stunning.</text>
        <text>Have you ever sucked feet for weed?</text>
        <text>That pet store's got everything we need. Except for piranhas.</text>
        <text>My life is as good as an Abba song. Itâ€™s as good as Dancing Queen.</text>
        <text>See what happens when you find a stranger in the alps?</text>
      </default>
    </column>



  <!-- script to parse and render the template -->
  <script>
 
    function snippetName(element) {
      var tagName = $(element).prop('tagName');
      if(tagName) {
        return $.camelCase(tagName.toLowerCase())
      }
      return null;
    }

    function getEditables(snippet) {
      if (!snippet.editables) return null; 
      return Object.keys(snippet.editables);
    }

    function getContainers(snippet) {
      if (!snippet.containers) return null; 
      return Object.keys(snippet.containers);
    }
    


    doc.kickstart = function(html) {

      var content = $(html).children().not('script');

      $('body').html($(document.createElement('div')).addClass('doc-section'));
      var templates = doc.getDesign().templates;
      
      doc.loadDocument();
      doc.ready(function() {

        content.each(function() {
          var element = this;
          var row = doc.add("bootstrap." + snippetName(element));
          if(row.hasContainers()) {
            parseContainers(row, $(element).children(getContainers(row).join(',')));
          }

          if(row.hasEditables()) {
            setEditables(row, element);
          }
        })

        function parseContainers(parent, data) {
          data.each(function() {
            var element = this;
            var containerName = snippetName(element);

            $(element).children().each(function() {
              var element = this;
              parseSnippets(parent, containerName, this)
            })
          });
        }

        function parseSnippets(parent, region, data) {
          $(data).each(function() {
            var element = this;
            var editableName = snippetName(element);
            
            var snippet = doc.create("bootstrap." + editableName);
            if(snippet.hasEditables()) {
              setEditables(snippet, element);
            }

            var row = parent.append(region, snippet);
            if(snippet.hasContainers()) {
              parseContainers(snippet, $(element).children(getContainers(snippet).join(',')));
            }
          })
        }

        function setEditables(parent, data) {
          for(var key in parent.editables) {
            var children = $(data).children().length;
            parent.set(key, null);

            if(!children) {
              parent.set(key, $(data).html());
            }
            else {
              parent.set(key, $(data).children(key + ':first').html());
            }
          }
        }

      });

    }


    $(document).ready(function() {

      doc.addDesign(design.bootstrap.snippets, design.bootstrap.config);
      doc.kickstart(document.body);       

    });
  </script>

</body>
</html>
